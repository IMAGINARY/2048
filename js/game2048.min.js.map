{"version":3,"sources":["game2048.js"],"names":["f","exports","module","define","amd","window","global","self","this","Game2048","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","Grid","Tile","GameManager","InputManager","View","StorageManager","config","size","storageManager","view","strings","inputManager","startTiles","bindGameContainer","gameContainer","bindRestartButton","restartButton","retryButton","bindKeepPlayingButton","keepPlayingButton","on","move","bind","restart","keepPlaying","helpTimeout","setup","blinkHelp","prototype","getElement","element","persistGameState","clearGameState","continueGame","isGameTerminated","over","won","previousState","getGameState","grid","cells","score","addStartTiles","actuate","addRandomTile","cellsAvailable","value","Math","random","tile","randomAvailableCell","insertTile","getBestScore","setBestScore","setGameState","serialize","bestScore","terminated","prepareTiles","eachCell","x","y","mergedFrom","savePosition","moveTile","cell","updatePosition","direction","vector","getVector","traversals","buildTraversals","moved","forEach","cellContent","positions","findFarthestPosition","next","merged","removeTile","farthest","positionsEqual","movesAvailable","0","2","3","pos","push","reverse","previous","withinBounds","cellAvailable","tileMatchesAvailable","other","first","second","pause","resume","./grid","./tile","fromState","empty","row","state","position","availableCells","floor","callback","cellOccupied","cellState","HTMLView","document","createElement","classList","add","container","append","messageContainer","messageContainerParagraph","lower","textContent","KEEP_GOING","TRY_AGAIN","gridContainer","j","tileContainer","NEW_GAME","scoreWrapper","scoreLabel","SCORE","scoreContainer","hiScoreWrapper","hiScoreLabel","HIGH_SCORE","bestContainer","helpText","HELP_TEXT","helpHand","metadata","requestAnimationFrame","clearContainer","column","addTile","updateScore","updateBestScore","message","clearMessage","firstChild","removeChild","wrapper","inner","previousPosition","positionClass","classes","applyClasses","appendChild","setAttribute","join","normalizePosition","difference","addition","type","YOU_WIN","GAME_OVER","remove","showHelp","setTimeout","hideHelp","clearTimeout","4","events","navigator","msPointerEnabled","eventTouchstart","eventTouchmove","eventTouchend","event","emit","data","callbacks","bindKeyboard","map","38","39","40","37","75","76","74","72","87","68","83","65","addEventListener","modifiers","altKey","ctrlKey","metaKey","shiftKey","mapped","which","undefined","preventDefault","touchStartClientX","touchStartClientY","touches","targetTouches","pageX","pageY","clientX","clientY","touchEndClientX","touchEndClientY","changedTouches","dx","absDx","abs","dy","absDy","max","button","bindButtonPress","fn","5","LocalStorageManager","bestScoreKey","bestScoreDateKey","gameStateKey","supported","localStorageSupported","storage","localStorage","IMAGINARY","game2048","fakeStorage","_data","setItem","id","val","String","getItem","hasOwnProperty","removeItem","clear","error","getCurrentDate","pad2","number","toString","padStart","now","Date","getFullYear","getMonth","getDate","stateJSON","JSON","parse","gameState","stringify","6","_defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","instance","Constructor","TypeError","_classCallCheck","gameManager","protoProps","staticProps","_createClass","get","./game_manager","./html_view","./input_manager","./local_storage_manager","./polyfills/animframe_polyfill","./polyfills/bind_polyfill","./polyfills/classlist_polyfill","./strings_de.json","7","lastTime","vendors","cancelAnimationFrame","currTime","getTime","timeToCall","8","Function","args","Array","apply","9","Element","documentElement","obj","prop","getter","splice","DOMTokenList","token","contains","el","className","indexOf","item","index","toggle","HTMLElement","__defineGetter__","replace","split","10","11"],"mappings":"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","file":"game2048.min.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.Game2048 = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nvar Grid = require('./grid');\n\nvar Tile = require('./tile');\n\nfunction GameManager(InputManager, View, StorageManager, config) {\n  this.config = config;\n  this.size = config.size; // Size of the grid\n\n  this.storageManager = new StorageManager();\n  this.view = new View(config.strings);\n  this.inputManager = new InputManager();\n  this.startTiles = 2;\n  this.inputManager.bindGameContainer(this.view.gameContainer);\n  this.inputManager.bindRestartButton(this.view.restartButton);\n  this.inputManager.bindRestartButton(this.view.retryButton);\n  this.inputManager.bindKeepPlayingButton(this.view.keepPlayingButton);\n  this.inputManager.on(\"move\", this.move.bind(this));\n  this.inputManager.on(\"restart\", this.restart.bind(this));\n  this.inputManager.on(\"keepPlaying\", this.keepPlaying.bind(this));\n  this.helpTimeout = null;\n  this.setup();\n  this.view.blinkHelp();\n}\n\nGameManager.prototype.getElement = function () {\n  return this.view.element;\n}; // Restart the game\n\n\nGameManager.prototype.restart = function () {\n  if (this.config.persistGameState) {\n    this.storageManager.clearGameState();\n  }\n\n  this.view.continueGame(); // Clear the game won/lost message\n\n  this.setup();\n  this.view.blinkHelp();\n}; // Keep playing after winning (allows going over 2048)\n\n\nGameManager.prototype.keepPlaying = function () {\n  this.keepPlaying = true;\n  this.view.continueGame(); // Clear the game won/lost message\n}; // Return true if the game is lost, or has won and the user hasn't kept playing\n\n\nGameManager.prototype.isGameTerminated = function () {\n  return this.over || this.won && !this.keepPlaying;\n}; // Set up the game\n\n\nGameManager.prototype.setup = function () {\n  var previousState = null;\n\n  if (this.config.persistGameState) {\n    previousState = this.storageManager.getGameState();\n  } // Reload the game from a previous game if present\n\n\n  if (previousState) {\n    this.grid = new Grid(previousState.grid.size, previousState.grid.cells); // Reload grid\n\n    this.score = previousState.score;\n    this.over = previousState.over;\n    this.won = previousState.won;\n    this.keepPlaying = previousState.keepPlaying;\n  } else {\n    this.grid = new Grid(this.size);\n    this.score = 0;\n    this.over = false;\n    this.won = false;\n    this.keepPlaying = false; // Add the initial tiles\n\n    this.addStartTiles();\n  } // Update the view\n\n\n  this.actuate();\n}; // Set up the initial tiles to start the game with\n\n\nGameManager.prototype.addStartTiles = function () {\n  for (var i = 0; i < this.startTiles; i++) {\n    this.addRandomTile();\n  }\n}; // Adds a tile in a random position\n\n\nGameManager.prototype.addRandomTile = function () {\n  if (this.grid.cellsAvailable()) {\n    var value = Math.random() < 0.9 ? 2 : 4;\n    var tile = new Tile(this.grid.randomAvailableCell(), value);\n    this.grid.insertTile(tile);\n  }\n}; // Sends the updated grid to the view\n\n\nGameManager.prototype.actuate = function () {\n  if (this.storageManager.getBestScore() < this.score) {\n    this.storageManager.setBestScore(this.score);\n  } // Clear the state when the game is over (game over only, not win)\n\n\n  if (this.config.persistGameState) {\n    if (this.over) {\n      this.storageManager.clearGameState();\n    } else {\n      this.storageManager.setGameState(this.serialize());\n    }\n  }\n\n  this.view.actuate(this.grid, {\n    score: this.score,\n    over: this.over,\n    won: this.won,\n    bestScore: this.storageManager.getBestScore(),\n    terminated: this.isGameTerminated()\n  });\n}; // Represent the current game as an object\n\n\nGameManager.prototype.serialize = function () {\n  return {\n    grid: this.grid.serialize(),\n    score: this.score,\n    over: this.over,\n    won: this.won,\n    keepPlaying: this.keepPlaying\n  };\n}; // Save all tile positions and remove merger info\n\n\nGameManager.prototype.prepareTiles = function () {\n  this.grid.eachCell(function (x, y, tile) {\n    if (tile) {\n      tile.mergedFrom = null;\n      tile.savePosition();\n    }\n  });\n}; // Move a tile and its representation\n\n\nGameManager.prototype.moveTile = function (tile, cell) {\n  this.grid.cells[tile.x][tile.y] = null;\n  this.grid.cells[cell.x][cell.y] = tile;\n  tile.updatePosition(cell);\n}; // Move tiles on the grid in the specified direction\n\n\nGameManager.prototype.move = function (direction) {\n  // 0: up, 1: right, 2: down, 3: left\n  var self = this;\n  if (this.isGameTerminated()) return; // Don't do anything if the game's over\n\n  var cell, tile;\n  var vector = this.getVector(direction);\n  var traversals = this.buildTraversals(vector);\n  var moved = false; // Save the current tile positions and remove merger information\n\n  this.prepareTiles(); // Traverse the grid in the right direction and move tiles\n\n  traversals.x.forEach(function (x) {\n    traversals.y.forEach(function (y) {\n      cell = {\n        x: x,\n        y: y\n      };\n      tile = self.grid.cellContent(cell);\n\n      if (tile) {\n        var positions = self.findFarthestPosition(cell, vector);\n        var next = self.grid.cellContent(positions.next); // Only one merger per row traversal?\n\n        if (next && next.value === tile.value && !next.mergedFrom) {\n          var merged = new Tile(positions.next, tile.value * 2);\n          merged.mergedFrom = [tile, next];\n          self.grid.insertTile(merged);\n          self.grid.removeTile(tile); // Converge the two tiles' positions\n\n          tile.updatePosition(positions.next); // Update the score\n\n          self.score += merged.value; // The mighty 2048 tile\n\n          if (merged.value === 2048) self.won = true;\n        } else {\n          self.moveTile(tile, positions.farthest);\n        }\n\n        if (!self.positionsEqual(cell, tile)) {\n          moved = true; // The tile moved from its original cell!\n        }\n      }\n    });\n  });\n\n  if (moved) {\n    this.addRandomTile();\n\n    if (!this.movesAvailable()) {\n      this.over = true; // Game over!\n    }\n\n    this.actuate();\n  }\n}; // Get the vector representing the chosen direction\n\n\nGameManager.prototype.getVector = function (direction) {\n  // Vectors representing tile movement\n  var map = {\n    0: {\n      x: 0,\n      y: -1\n    },\n    // Up\n    1: {\n      x: 1,\n      y: 0\n    },\n    // Right\n    2: {\n      x: 0,\n      y: 1\n    },\n    // Down\n    3: {\n      x: -1,\n      y: 0 // Left\n\n    }\n  };\n  return map[direction];\n}; // Build a list of positions to traverse in the right order\n\n\nGameManager.prototype.buildTraversals = function (vector) {\n  var traversals = {\n    x: [],\n    y: []\n  };\n\n  for (var pos = 0; pos < this.size; pos++) {\n    traversals.x.push(pos);\n    traversals.y.push(pos);\n  } // Always traverse from the farthest cell in the chosen direction\n\n\n  if (vector.x === 1) traversals.x = traversals.x.reverse();\n  if (vector.y === 1) traversals.y = traversals.y.reverse();\n  return traversals;\n};\n\nGameManager.prototype.findFarthestPosition = function (cell, vector) {\n  var previous; // Progress towards the vector direction until an obstacle is found\n\n  do {\n    previous = cell;\n    cell = {\n      x: previous.x + vector.x,\n      y: previous.y + vector.y\n    };\n  } while (this.grid.withinBounds(cell) && this.grid.cellAvailable(cell));\n\n  return {\n    farthest: previous,\n    next: cell // Used to check if a merge is required\n\n  };\n};\n\nGameManager.prototype.movesAvailable = function () {\n  return this.grid.cellsAvailable() || this.tileMatchesAvailable();\n}; // Check for available matches between tiles (more expensive check)\n\n\nGameManager.prototype.tileMatchesAvailable = function () {\n  var self = this;\n  var tile;\n\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      tile = this.grid.cellContent({\n        x: x,\n        y: y\n      });\n\n      if (tile) {\n        for (var direction = 0; direction < 4; direction++) {\n          var vector = self.getVector(direction);\n          var cell = {\n            x: x + vector.x,\n            y: y + vector.y\n          };\n          var other = self.grid.cellContent(cell);\n\n          if (other && other.value === tile.value) {\n            return true; // These two tiles can be merged\n          }\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nGameManager.prototype.positionsEqual = function (first, second) {\n  return first.x === second.x && first.y === second.y;\n};\n\nGameManager.prototype.pause = function () {\n  this.view.pause();\n};\n\nGameManager.prototype.resume = function () {\n  this.view.resume();\n};\n\nmodule.exports = GameManager;\n\n},{\"./grid\":2,\"./tile\":11}],2:[function(require,module,exports){\n\"use strict\";\n\nvar Tile = require('./tile');\n\nfunction Grid(size, previousState) {\n  this.size = size;\n  this.cells = previousState ? this.fromState(previousState) : this.empty();\n} // Build a grid of the specified size\n\n\nGrid.prototype.empty = function () {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(null);\n    }\n  }\n\n  return cells;\n};\n\nGrid.prototype.fromState = function (state) {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      var tile = state[x][y];\n      row.push(tile ? new Tile(tile.position, tile.value) : null);\n    }\n  }\n\n  return cells;\n}; // Find the first available random position\n\n\nGrid.prototype.randomAvailableCell = function () {\n  var cells = this.availableCells();\n\n  if (cells.length) {\n    return cells[Math.floor(Math.random() * cells.length)];\n  }\n};\n\nGrid.prototype.availableCells = function () {\n  var cells = [];\n  this.eachCell(function (x, y, tile) {\n    if (!tile) {\n      cells.push({\n        x: x,\n        y: y\n      });\n    }\n  });\n  return cells;\n}; // Call callback for every cell\n\n\nGrid.prototype.eachCell = function (callback) {\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      callback(x, y, this.cells[x][y]);\n    }\n  }\n}; // Check if there are any cells available\n\n\nGrid.prototype.cellsAvailable = function () {\n  return !!this.availableCells().length;\n}; // Check if the specified cell is taken\n\n\nGrid.prototype.cellAvailable = function (cell) {\n  return !this.cellOccupied(cell);\n};\n\nGrid.prototype.cellOccupied = function (cell) {\n  return !!this.cellContent(cell);\n};\n\nGrid.prototype.cellContent = function (cell) {\n  if (this.withinBounds(cell)) {\n    return this.cells[cell.x][cell.y];\n  } else {\n    return null;\n  }\n}; // Inserts a tile at its position\n\n\nGrid.prototype.insertTile = function (tile) {\n  this.cells[tile.x][tile.y] = tile;\n};\n\nGrid.prototype.removeTile = function (tile) {\n  this.cells[tile.x][tile.y] = null;\n};\n\nGrid.prototype.withinBounds = function (position) {\n  return position.x >= 0 && position.x < this.size && position.y >= 0 && position.y < this.size;\n};\n\nGrid.prototype.serialize = function () {\n  var cellState = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cellState[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(this.cells[x][y] ? this.cells[x][y].serialize() : null);\n    }\n  }\n\n  return {\n    size: this.size,\n    cells: cellState\n  };\n};\n\nmodule.exports = Grid;\n\n},{\"./tile\":11}],3:[function(require,module,exports){\n\"use strict\";\n\nfunction HTMLView(strings) {\n  this.strings = strings;\n  this.element = document.createElement('div');\n  this.element.classList.add('game2048');\n  this.container = document.createElement('div');\n  this.container.classList.add('container');\n  this.element.append(this.container);\n  this.gameContainer = document.createElement(\"div\");\n  this.gameContainer.classList.add('game-container');\n  this.container.append(this.gameContainer); // Message Container\n\n  this.messageContainer = document.createElement('div');\n  this.messageContainer.classList.add('game-message');\n  this.messageContainerParagraph = document.createElement('p');\n  this.messageContainer.append(this.messageContainerParagraph);\n  this.gameContainer.append(this.messageContainer); // -- Lower\n\n  var lower = document.createElement('div');\n  lower.classList.add('lower');\n  this.messageContainer.append(lower); // ------ Keep playing button\n\n  this.keepPlayingButton = document.createElement('a');\n  this.keepPlayingButton.classList.add('keep-playing-button');\n  this.keepPlayingButton.textContent = this.strings.KEEP_GOING;\n  lower.append(this.keepPlayingButton); // ------ Retry button\n\n  this.retryButton = document.createElement('a');\n  this.retryButton.classList.add('retry-button');\n  this.retryButton.textContent = this.strings.TRY_AGAIN;\n  lower.append(this.retryButton);\n  this.messageContainer.append(lower); // Grid container\n\n  var size = 4;\n  var gridContainer = document.createElement('div');\n  gridContainer.classList.add('grid-container');\n\n  for (var i = 0; i !== size; i += 1) {\n    var row = document.createElement('div');\n    row.classList.add('grid-row');\n    gridContainer.append(row);\n\n    for (var j = 0; j !== size; j += 1) {\n      var cell = document.createElement('div');\n      cell.classList.add('grid-cell');\n      row.append(cell);\n    }\n  }\n\n  this.gameContainer.append(gridContainer); //Tile container\n\n  this.tileContainer = document.createElement('div');\n  this.tileContainer.classList.add('tile-container');\n  this.gameContainer.append(this.tileContainer); // Restart button\n\n  this.restartButton = document.createElement('a');\n  this.restartButton.classList.add('restart-button');\n  this.restartButton.textContent = this.strings.NEW_GAME;\n  this.container.append(this.restartButton); // Score wrapper\n\n  var scoreWrapper = document.createElement('div');\n  scoreWrapper.classList.add('score-wrapper');\n  scoreWrapper.classList.add('score-wrapper-score');\n  var scoreLabel = document.createElement('div');\n  scoreLabel.classList.add('label');\n  scoreLabel.textContent = this.strings.SCORE;\n  scoreWrapper.append(scoreLabel);\n  this.scoreContainer = document.createElement('div');\n  this.scoreContainer.classList.add('score-container');\n  this.scoreContainer.textContent = '0';\n  scoreWrapper.append(this.scoreContainer);\n  this.container.append(scoreWrapper); // Hi-score wrapper\n\n  var hiScoreWrapper = document.createElement('div');\n  hiScoreWrapper.classList.add('score-wrapper');\n  hiScoreWrapper.classList.add('score-wrapper-best');\n  var hiScoreLabel = document.createElement('div');\n  hiScoreLabel.classList.add('label');\n  hiScoreLabel.textContent = this.strings.HIGH_SCORE;\n  hiScoreWrapper.append(hiScoreLabel);\n  this.bestContainer = document.createElement('div');\n  this.bestContainer.classList.add('best-container');\n  this.bestContainer.textContent = '0';\n  hiScoreWrapper.append(this.bestContainer);\n  this.container.append(hiScoreWrapper); // Help text\n\n  this.helpText = document.createElement('div');\n  this.helpText.classList.add('helping-text');\n  this.helpText.textContent = this.strings.HELP_TEXT;\n  this.container.append(this.helpText); // Help hand\n\n  this.helpHand = document.createElement('div');\n  this.helpHand.classList.add('helping-hand');\n  this.container.append(this.helpHand);\n  this.helpTimeout = null;\n  this.score = 0;\n}\n\nHTMLView.prototype.actuate = function (grid, metadata) {\n  var self = this;\n  window.requestAnimationFrame(function () {\n    self.clearContainer(self.tileContainer);\n    grid.cells.forEach(function (column) {\n      column.forEach(function (cell) {\n        if (cell) {\n          self.addTile(cell);\n        }\n      });\n    });\n    self.updateScore(metadata.score);\n    self.updateBestScore(metadata.bestScore);\n\n    if (metadata.terminated) {\n      if (metadata.over) {\n        self.message(false); // You lose\n      } else if (metadata.won) {\n        self.message(true); // You win!\n      }\n    }\n  });\n}; // Continues the game (both restart and keep playing)\n\n\nHTMLView.prototype.continueGame = function () {\n  this.clearMessage();\n};\n\nHTMLView.prototype.clearContainer = function (container) {\n  while (container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n};\n\nHTMLView.prototype.addTile = function (tile) {\n  var self = this;\n  var wrapper = document.createElement(\"div\");\n  var inner = document.createElement(\"div\");\n  var position = tile.previousPosition || {\n    x: tile.x,\n    y: tile.y\n  };\n  var positionClass = this.positionClass(position); // We can't use classlist because it somehow glitches when replacing classes\n\n  var classes = [\"tile\", \"tile-\" + tile.value, positionClass];\n  if (tile.value > 2048) classes.push(\"tile-super\");\n  this.applyClasses(wrapper, classes);\n  inner.classList.add(\"tile-inner\");\n  inner.textContent = tile.value;\n\n  if (tile.previousPosition) {\n    // Make sure that the tile gets rendered in the previous position first\n    window.requestAnimationFrame(function () {\n      classes[2] = self.positionClass({\n        x: tile.x,\n        y: tile.y\n      });\n      self.applyClasses(wrapper, classes); // Update the position\n    });\n  } else if (tile.mergedFrom) {\n    classes.push(\"tile-merged\");\n    this.applyClasses(wrapper, classes); // Render the tiles that merged\n\n    tile.mergedFrom.forEach(function (merged) {\n      self.addTile(merged);\n    });\n  } else {\n    classes.push(\"tile-new\");\n    this.applyClasses(wrapper, classes);\n  } // Add the inner part of the tile to the wrapper\n\n\n  wrapper.appendChild(inner); // Put the tile on the board\n\n  this.tileContainer.appendChild(wrapper);\n};\n\nHTMLView.prototype.applyClasses = function (element, classes) {\n  element.setAttribute(\"class\", classes.join(\" \"));\n};\n\nHTMLView.prototype.normalizePosition = function (position) {\n  return {\n    x: position.x + 1,\n    y: position.y + 1\n  };\n};\n\nHTMLView.prototype.positionClass = function (position) {\n  position = this.normalizePosition(position);\n  return \"tile-position-\" + position.x + \"-\" + position.y;\n};\n\nHTMLView.prototype.updateScore = function (score) {\n  this.clearContainer(this.scoreContainer);\n  var difference = score - this.score;\n  this.score = score;\n  this.scoreContainer.textContent = this.score;\n\n  if (difference > 0) {\n    var addition = document.createElement(\"div\");\n    addition.classList.add(\"score-addition\");\n    addition.textContent = \"+\" + difference;\n    this.scoreContainer.appendChild(addition);\n  }\n};\n\nHTMLView.prototype.updateBestScore = function (bestScore) {\n  this.bestContainer.textContent = bestScore;\n};\n\nHTMLView.prototype.message = function (won) {\n  var type = won ? \"game-won\" : \"game-over\";\n  var message = won ? this.strings.YOU_WIN : this.strings.GAME_OVER;\n  this.messageContainer.classList.add(type);\n  this.messageContainerParagraph.textContent = message;\n};\n\nHTMLView.prototype.clearMessage = function () {\n  // IE only takes one value to remove at a time.\n  this.messageContainer.classList.remove(\"game-won\");\n  this.messageContainer.classList.remove(\"game-over\");\n};\n\nHTMLView.prototype.showHelp = function () {\n  window.setTimeout(function () {\n    this.helpHand.classList.add('shown');\n    this.helpText.classList.add('shown');\n  }.bind(this), 0);\n};\n\nHTMLView.prototype.hideHelp = function () {\n  if (this.helpTimeout !== null) {\n    window.clearTimeout(this.helpTimeout);\n    this.helpTimeout = null;\n  }\n\n  this.helpHand.classList.remove('shown');\n  this.helpText.classList.remove('shown');\n};\n\nHTMLView.prototype.blinkHelp = function () {\n  this.hideHelp();\n  this.helpTimeout = window.setTimeout(this.hideHelp.bind(this), 6000);\n  this.showHelp();\n};\n\nHTMLView.prototype.pause = function () {\n  this.element.classList.add('paused');\n};\n\nHTMLView.prototype.resume = function () {\n  this.element.classList.remove('paused');\n};\n\nmodule.exports = HTMLView;\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\nfunction InputManager() {\n  this.events = {};\n\n  if (window.navigator.msPointerEnabled) {\n    //Internet Explorer 10 style\n    this.eventTouchstart = \"MSPointerDown\";\n    this.eventTouchmove = \"MSPointerMove\";\n    this.eventTouchend = \"MSPointerUp\";\n  } else {\n    this.eventTouchstart = \"touchstart\";\n    this.eventTouchmove = \"touchmove\";\n    this.eventTouchend = \"touchend\";\n  }\n}\n\nInputManager.prototype.on = function (event, callback) {\n  if (!this.events[event]) {\n    this.events[event] = [];\n  }\n\n  this.events[event].push(callback);\n};\n\nInputManager.prototype.emit = function (event, data) {\n  var callbacks = this.events[event];\n\n  if (callbacks) {\n    callbacks.forEach(function (callback) {\n      callback(data);\n    });\n  }\n};\n\nInputManager.prototype.bindKeyboard = function () {\n  var self = this;\n  var map = {\n    38: 0,\n    // Up\n    39: 1,\n    // Right\n    40: 2,\n    // Down\n    37: 3,\n    // Left\n    75: 0,\n    // Vim up\n    76: 1,\n    // Vim right\n    74: 2,\n    // Vim down\n    72: 3,\n    // Vim left\n    87: 0,\n    // W\n    68: 1,\n    // D\n    83: 2,\n    // S\n    65: 3 // A\n\n  }; // Respond to direction keys\n\n  document.addEventListener(\"keydown\", function (event) {\n    var modifiers = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;\n    var mapped = map[event.which];\n\n    if (!modifiers) {\n      if (mapped !== undefined) {\n        event.preventDefault();\n        self.emit(\"move\", mapped);\n      }\n    } // R key restarts the game\n\n\n    if (!modifiers && event.which === 82) {\n      self.restart.call(self, event);\n    }\n  });\n};\n\nInputManager.prototype.bindGameContainer = function (gameContainer) {\n  var self = this; // Respond to swipe events\n\n  var touchStartClientX, touchStartClientY;\n  gameContainer.addEventListener(this.eventTouchstart, function (event) {\n    if (!window.navigator.msPointerEnabled && event.touches.length > 1 || event.targetTouches.length > 1) {\n      return; // Ignore if touching with more than 1 finger\n    }\n\n    if (window.navigator.msPointerEnabled) {\n      touchStartClientX = event.pageX;\n      touchStartClientY = event.pageY;\n    } else {\n      touchStartClientX = event.touches[0].clientX;\n      touchStartClientY = event.touches[0].clientY;\n    }\n\n    event.preventDefault();\n  });\n  gameContainer.addEventListener(this.eventTouchmove, function (event) {\n    event.preventDefault();\n  });\n  gameContainer.addEventListener(this.eventTouchend, function (event) {\n    if (!window.navigator.msPointerEnabled && event.touches.length > 0 || event.targetTouches.length > 0) {\n      return; // Ignore if still touching with one or more fingers\n    }\n\n    var touchEndClientX, touchEndClientY;\n\n    if (window.navigator.msPointerEnabled) {\n      touchEndClientX = event.pageX;\n      touchEndClientY = event.pageY;\n    } else {\n      touchEndClientX = event.changedTouches[0].clientX;\n      touchEndClientY = event.changedTouches[0].clientY;\n    }\n\n    var dx = touchEndClientX - touchStartClientX;\n    var absDx = Math.abs(dx);\n    var dy = touchEndClientY - touchStartClientY;\n    var absDy = Math.abs(dy);\n\n    if (Math.max(absDx, absDy) > 10) {\n      // (right : left) : (down : up)\n      self.emit(\"move\", absDx > absDy ? dx > 0 ? 1 : 3 : dy > 0 ? 2 : 0);\n    }\n  });\n};\n\nInputManager.prototype.bindRestartButton = function (button) {\n  this.bindButtonPress(button, this.restart);\n};\n\nInputManager.prototype.bindKeepPlayingButton = function (button) {\n  this.bindButtonPress(button, this.keepPlaying);\n};\n\nInputManager.prototype.restart = function (event) {\n  event.preventDefault();\n  this.emit(\"restart\");\n};\n\nInputManager.prototype.keepPlaying = function (event) {\n  event.preventDefault();\n  this.emit(\"keepPlaying\");\n};\n\nInputManager.prototype.bindButtonPress = function (button, fn) {\n  button.addEventListener(\"click\", fn.bind(this));\n  button.addEventListener(this.eventTouchend, fn.bind(this));\n};\n\nmodule.exports = InputManager;\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nif (window.IMAGINARY === undefined) {\n  window.IMAGINARY = {};\n}\n\nif (window.IMAGINARY.game2048 === undefined) {\n  window.IMAGINARY.game2048 = {};\n}\n\nwindow.IMAGINARY.game2048.fakeStorage = {\n  _data: {},\n  setItem: function setItem(id, val) {\n    return this._data[id] = String(val);\n  },\n  getItem: function getItem(id) {\n    return this._data.hasOwnProperty(id) ? this._data[id] : undefined;\n  },\n  removeItem: function removeItem(id) {\n    return delete this._data[id];\n  },\n  clear: function clear() {\n    return this._data = {};\n  }\n};\n\nfunction LocalStorageManager() {\n  this.bestScoreKey = \"IMAGINARY.game2048.bestScore\";\n  this.bestScoreDateKey = \"IMAGINARY.game2048.bestScoreDate\";\n  this.gameStateKey = \"IMAGINARY.game2048.gameState\";\n  var supported = this.localStorageSupported();\n  this.storage = supported ? window.localStorage : window.IMAGINARY.game2048.fakeStorage;\n}\n\nLocalStorageManager.prototype.localStorageSupported = function () {\n  var testKey = \"test\";\n\n  try {\n    var storage = window.localStorage;\n    storage.setItem(testKey, \"1\");\n    storage.removeItem(testKey);\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n\nLocalStorageManager.prototype.getCurrentDate = function () {\n  var now = new Date();\n\n  var pad2 = function pad2(number) {\n    return number.toString().padStart(2, '0');\n  };\n\n  return [now.getFullYear(), pad2(now.getMonth() + 1), pad2(now.getDate())].join('-');\n}; // Best score getters/setters\n\n\nLocalStorageManager.prototype.getBestScore = function () {\n  var bestDate = this.storage.getItem(this.bestScoreDateKey);\n\n  if (bestDate === this.getCurrentDate()) {\n    return this.storage.getItem(this.bestScoreKey) || 0;\n  }\n\n  return 0;\n};\n\nLocalStorageManager.prototype.setBestScore = function (score) {\n  this.storage.setItem(this.bestScoreDateKey, this.getCurrentDate());\n  this.storage.setItem(this.bestScoreKey, score);\n}; // Game state getters/setters and clearing\n\n\nLocalStorageManager.prototype.getGameState = function () {\n  var stateJSON = this.storage.getItem(this.gameStateKey);\n  return stateJSON ? JSON.parse(stateJSON) : null;\n};\n\nLocalStorageManager.prototype.setGameState = function (gameState) {\n  this.storage.setItem(this.gameStateKey, JSON.stringify(gameState));\n};\n\nLocalStorageManager.prototype.clearGameState = function () {\n  this.storage.removeItem(this.gameStateKey);\n};\n\nmodule.exports = LocalStorageManager;\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nrequire('./polyfills/bind_polyfill');\n\nrequire('./polyfills/classlist_polyfill');\n\nrequire('./polyfills/animframe_polyfill');\n\nvar GameManager = require('./game_manager');\n\nvar InputManager = require('./input_manager');\n\nvar HTMLView = require('./html_view');\n\nvar LocalStorageManager = require('./local_storage_manager');\n\nvar strings = require('./strings_de.json');\n\nvar Game2048 =\n/*#__PURE__*/\nfunction () {\n  function Game2048() {\n    _classCallCheck(this, Game2048);\n\n    var config = {\n      size: 4,\n      persistGameState: false,\n      strings: strings\n    };\n    this.gameManager = new GameManager(InputManager, HTMLView, LocalStorageManager, config);\n  }\n\n  _createClass(Game2048, [{\n    key: \"pause\",\n    value: function pause() {\n      this.gameManager.pause();\n    }\n  }, {\n    key: \"resume\",\n    value: function resume() {\n      this.gameManager.resume();\n    }\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.gameManager.restart();\n    }\n  }, {\n    key: \"domElement\",\n    get: function get() {\n      return this.gameManager.getElement();\n    }\n  }]);\n\n  return Game2048;\n}();\n\nmodule.exports = Game2048;\n\n},{\"./game_manager\":1,\"./html_view\":3,\"./input_manager\":4,\"./local_storage_manager\":5,\"./polyfills/animframe_polyfill\":7,\"./polyfills/bind_polyfill\":8,\"./polyfills/classlist_polyfill\":9,\"./strings_de.json\":10}],7:[function(require,module,exports){\n\"use strict\";\n\n(function () {\n  var lastTime = 0;\n  var vendors = ['webkit', 'moz'];\n\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\n  }\n\n  if (!window.requestAnimationFrame) {\n    window.requestAnimationFrame = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = window.setTimeout(function () {\n        callback(currTime + timeToCall);\n      }, timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  if (!window.cancelAnimationFrame) {\n    window.cancelAnimationFrame = function (id) {\n      clearTimeout(id);\n    };\n  }\n})();\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n\nFunction.prototype.bind = Function.prototype.bind || function (target) {\n  var self = this;\n  return function (args) {\n    if (!(args instanceof Array)) {\n      args = [args];\n    }\n\n    self.apply(target, args);\n  };\n};\n\n},{}],9:[function(require,module,exports){\n\"use strict\";\n\n(function () {\n  if (typeof window.Element === \"undefined\" || \"classList\" in document.documentElement) {\n    return;\n  }\n\n  var prototype = Array.prototype,\n      push = prototype.push,\n      splice = prototype.splice,\n      join = prototype.join;\n\n  function DOMTokenList(el) {\n    this.el = el; // The className needs to be trimmed and split on whitespace\n    // to retrieve a list of classes.\n\n    var classes = el.className.replace(/^\\s+|\\s+$/g, '').split(/\\s+/);\n\n    for (var i = 0; i < classes.length; i++) {\n      push.call(this, classes[i]);\n    }\n  }\n\n  DOMTokenList.prototype = {\n    add: function add(token) {\n      if (this.contains(token)) return;\n      push.call(this, token);\n      this.el.className = this.toString();\n    },\n    contains: function contains(token) {\n      return this.el.className.indexOf(token) != -1;\n    },\n    item: function item(index) {\n      return this[index] || null;\n    },\n    remove: function remove(token) {\n      if (!this.contains(token)) return;\n\n      for (var i = 0; i < this.length; i++) {\n        if (this[i] == token) break;\n      }\n\n      splice.call(this, i, 1);\n      this.el.className = this.toString();\n    },\n    toString: function toString() {\n      return join.call(this, ' ');\n    },\n    toggle: function toggle(token) {\n      if (!this.contains(token)) {\n        this.add(token);\n      } else {\n        this.remove(token);\n      }\n\n      return this.contains(token);\n    }\n  };\n  window.DOMTokenList = DOMTokenList;\n\n  function defineElementGetter(obj, prop, getter) {\n    if (Object.defineProperty) {\n      Object.defineProperty(obj, prop, {\n        get: getter\n      });\n    } else {\n      obj.__defineGetter__(prop, getter);\n    }\n  }\n\n  defineElementGetter(HTMLElement.prototype, 'classList', function () {\n    return new DOMTokenList(this);\n  });\n})();\n\n},{}],10:[function(require,module,exports){\nmodule.exports={\n  \"KEEP_GOING\": \"Mach weiter\",\n  \"TRY_AGAIN\": \"Nochmal versuchen\",\n  \"NEW_GAME\": \"Neues Spiel\",\n  \"SCORE\": \"Punkte\",\n  \"HIGH_SCORE\": \"Tagesrekord\",\n  \"HELP_TEXT\": \"Wische über das Spielfeld, um Kacheln mit demselben Symbol zu verschmelzen.\",\n  \"YOU_WIN\": \"Gewonnen!\",\n  \"GAME_OVER\": \"Game over!\"\n}\n\n},{}],11:[function(require,module,exports){\n\"use strict\";\n\nfunction Tile(position, value) {\n  this.x = position.x;\n  this.y = position.y;\n  this.value = value || 2;\n  this.previousPosition = null;\n  this.mergedFrom = null; // Tracks tiles that merged together\n}\n\nTile.prototype.savePosition = function () {\n  this.previousPosition = {\n    x: this.x,\n    y: this.y\n  };\n};\n\nTile.prototype.updatePosition = function (position) {\n  this.x = position.x;\n  this.y = position.y;\n};\n\nTile.prototype.serialize = function () {\n  return {\n    position: {\n      x: this.x,\n      y: this.y\n    },\n    value: this.value\n  };\n};\n\nmodule.exports = Tile;\n\n},{}]},{},[6])(6)\n});\n"]}