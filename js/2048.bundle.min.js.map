{"version":3,"sources":["2048.bundle.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","lastTime","vendors","x","window","requestAnimationFrame","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","2","GameManager","KeyboardInputManager","HTMLActuator","LocalStorageManager","./game_manager","./html_actuator","./keyboard_input_manager","./local_storage_manager","3","Function","prototype","bind","target","self","this","args","Array","apply","4","Element","document","documentElement","obj","prop","getter","push","splice","join","DOMTokenList","add","token","contains","el","className","toString","indexOf","item","index","remove","toggle","HTMLElement","Object","defineProperty","get","__defineGetter__","classes","replace","split","5","Grid","Tile","size","InputManager","Actuator","StorageManager","inputManager","storageManager","actuator","startTiles","on","move","restart","keepPlaying","helpTimeout","setup","blinkHelp","clearGameState","continueGame","isGameTerminated","over","won","previousState","getGameState","grid","cells","score","addStartTiles","actuate","addRandomTile","cellsAvailable","value","random","tile","randomAvailableCell","insertTile","getBestScore","setBestScore","setGameState","serialize","bestScore","terminated","prepareTiles","eachCell","y","mergedFrom","savePosition","moveTile","cell","updatePosition","direction","vector","getVector","traversals","buildTraversals","moved","forEach","cellContent","positions","findFarthestPosition","next","merged","removeTile","farthest","positionsEqual","movesAvailable","0","pos","reverse","previous","withinBounds","cellAvailable","tileMatchesAvailable","other","first","second","./grid","./tile","6","fromState","empty","row","state","position","availableCells","floor","cellOccupied","cellState","7","tileContainer","querySelector","scoreContainer","bestContainer","messageContainer","helpHand","helpText","metadata","clearContainer","column","addTile","updateScore","updateBestScore","message","clearMessage","container","firstChild","removeChild","wrapper","createElement","inner","previousPosition","positionClass","applyClasses","classList","textContent","appendChild","element","setAttribute","normalizePosition","difference","addition","type","getElementsByTagName","showHelp","hideHelp","8","events","navigator","msPointerEnabled","eventTouchstart","eventTouchmove","eventTouchend","listen","event","emit","data","callbacks","touchStartClientX","touchStartClientY","map","38","39","40","37","75","76","74","72","87","68","83","65","addEventListener","modifiers","altKey","ctrlKey","metaKey","shiftKey","mapped","which","undefined","preventDefault","bindButtonPress","gameContainer","getElementsByClassName","touches","targetTouches","pageX","pageY","clientX","clientY","touchEndClientX","touchEndClientY","changedTouches","dx","absDx","abs","dy","absDy","selector","fn","button","9","bestScoreKey","gameStateKey","supported","localStorageSupported","storage","localStorage","fakeStorage","_data","setItem","val","String","getItem","hasOwnProperty","removeItem","clear","error","stateJSON","JSON","parse","gameState","stringify","10","./animframe_polyfill","./application","./bind_polyfill","./classlist_polyfill","11"],"mappings":"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","file":"2048.bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n(function () {\n  var lastTime = 0;\n  var vendors = ['webkit', 'moz'];\n\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\n  }\n\n  if (!window.requestAnimationFrame) {\n    window.requestAnimationFrame = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = window.setTimeout(function () {\n        callback(currTime + timeToCall);\n      }, timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  if (!window.cancelAnimationFrame) {\n    window.cancelAnimationFrame = function (id) {\n      clearTimeout(id);\n    };\n  }\n})();\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\n\nvar GameManager = require('./game_manager');\n\nvar KeyboardInputManager = require('./keyboard_input_manager');\n\nvar HTMLActuator = require('./html_actuator');\n\nvar LocalStorageManager = require('./local_storage_manager'); // Wait till the browser is ready to render the game (avoids glitches)\n\n\nwindow.requestAnimationFrame(function () {\n  new GameManager(4, KeyboardInputManager, HTMLActuator, LocalStorageManager);\n});\n\n},{\"./game_manager\":5,\"./html_actuator\":7,\"./keyboard_input_manager\":8,\"./local_storage_manager\":9}],3:[function(require,module,exports){\n\"use strict\";\n\nFunction.prototype.bind = Function.prototype.bind || function (target) {\n  var self = this;\n  return function (args) {\n    if (!(args instanceof Array)) {\n      args = [args];\n    }\n\n    self.apply(target, args);\n  };\n};\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\n(function () {\n  if (typeof window.Element === \"undefined\" || \"classList\" in document.documentElement) {\n    return;\n  }\n\n  var prototype = Array.prototype,\n      push = prototype.push,\n      splice = prototype.splice,\n      join = prototype.join;\n\n  function DOMTokenList(el) {\n    this.el = el; // The className needs to be trimmed and split on whitespace\n    // to retrieve a list of classes.\n\n    var classes = el.className.replace(/^\\s+|\\s+$/g, '').split(/\\s+/);\n\n    for (var i = 0; i < classes.length; i++) {\n      push.call(this, classes[i]);\n    }\n  }\n\n  DOMTokenList.prototype = {\n    add: function add(token) {\n      if (this.contains(token)) return;\n      push.call(this, token);\n      this.el.className = this.toString();\n    },\n    contains: function contains(token) {\n      return this.el.className.indexOf(token) != -1;\n    },\n    item: function item(index) {\n      return this[index] || null;\n    },\n    remove: function remove(token) {\n      if (!this.contains(token)) return;\n\n      for (var i = 0; i < this.length; i++) {\n        if (this[i] == token) break;\n      }\n\n      splice.call(this, i, 1);\n      this.el.className = this.toString();\n    },\n    toString: function toString() {\n      return join.call(this, ' ');\n    },\n    toggle: function toggle(token) {\n      if (!this.contains(token)) {\n        this.add(token);\n      } else {\n        this.remove(token);\n      }\n\n      return this.contains(token);\n    }\n  };\n  window.DOMTokenList = DOMTokenList;\n\n  function defineElementGetter(obj, prop, getter) {\n    if (Object.defineProperty) {\n      Object.defineProperty(obj, prop, {\n        get: getter\n      });\n    } else {\n      obj.__defineGetter__(prop, getter);\n    }\n  }\n\n  defineElementGetter(HTMLElement.prototype, 'classList', function () {\n    return new DOMTokenList(this);\n  });\n})();\n\n},{}],5:[function(require,module,exports){\n\"use strict\";\n\nvar Grid = require('./grid');\n\nvar Tile = require('./tile');\n\nfunction GameManager(size, InputManager, Actuator, StorageManager) {\n  this.size = size; // Size of the grid\n\n  this.inputManager = new InputManager();\n  this.storageManager = new StorageManager();\n  this.actuator = new Actuator();\n  this.startTiles = 2;\n  this.inputManager.on(\"move\", this.move.bind(this));\n  this.inputManager.on(\"restart\", this.restart.bind(this));\n  this.inputManager.on(\"keepPlaying\", this.keepPlaying.bind(this));\n  this.helpTimeout = null;\n  this.setup();\n  this.actuator.blinkHelp();\n} // Restart the game\n\n\nGameManager.prototype.restart = function () {\n  this.storageManager.clearGameState();\n  this.actuator.continueGame(); // Clear the game won/lost message\n\n  this.setup();\n  this.actuator.blinkHelp();\n}; // Keep playing after winning (allows going over 2048)\n\n\nGameManager.prototype.keepPlaying = function () {\n  this.keepPlaying = true;\n  this.actuator.continueGame(); // Clear the game won/lost message\n}; // Return true if the game is lost, or has won and the user hasn't kept playing\n\n\nGameManager.prototype.isGameTerminated = function () {\n  return this.over || this.won && !this.keepPlaying;\n}; // Set up the game\n\n\nGameManager.prototype.setup = function () {\n  var previousState = this.storageManager.getGameState(); // Reload the game from a previous game if present\n\n  if (previousState) {\n    this.grid = new Grid(previousState.grid.size, previousState.grid.cells); // Reload grid\n\n    this.score = previousState.score;\n    this.over = previousState.over;\n    this.won = previousState.won;\n    this.keepPlaying = previousState.keepPlaying;\n  } else {\n    this.grid = new Grid(this.size);\n    this.score = 0;\n    this.over = false;\n    this.won = false;\n    this.keepPlaying = false; // Add the initial tiles\n\n    this.addStartTiles();\n  } // Update the actuator\n\n\n  this.actuate();\n}; // Set up the initial tiles to start the game with\n\n\nGameManager.prototype.addStartTiles = function () {\n  for (var i = 0; i < this.startTiles; i++) {\n    this.addRandomTile();\n  }\n}; // Adds a tile in a random position\n\n\nGameManager.prototype.addRandomTile = function () {\n  if (this.grid.cellsAvailable()) {\n    var value = Math.random() < 0.9 ? 2 : 4;\n    var tile = new Tile(this.grid.randomAvailableCell(), value);\n    this.grid.insertTile(tile);\n  }\n}; // Sends the updated grid to the actuator\n\n\nGameManager.prototype.actuate = function () {\n  if (this.storageManager.getBestScore() < this.score) {\n    this.storageManager.setBestScore(this.score);\n  } // Clear the state when the game is over (game over only, not win)\n\n\n  if (this.over) {\n    this.storageManager.clearGameState();\n  } else {\n    this.storageManager.setGameState(this.serialize());\n  }\n\n  this.actuator.actuate(this.grid, {\n    score: this.score,\n    over: this.over,\n    won: this.won,\n    bestScore: this.storageManager.getBestScore(),\n    terminated: this.isGameTerminated()\n  });\n}; // Represent the current game as an object\n\n\nGameManager.prototype.serialize = function () {\n  return {\n    grid: this.grid.serialize(),\n    score: this.score,\n    over: this.over,\n    won: this.won,\n    keepPlaying: this.keepPlaying\n  };\n}; // Save all tile positions and remove merger info\n\n\nGameManager.prototype.prepareTiles = function () {\n  this.grid.eachCell(function (x, y, tile) {\n    if (tile) {\n      tile.mergedFrom = null;\n      tile.savePosition();\n    }\n  });\n}; // Move a tile and its representation\n\n\nGameManager.prototype.moveTile = function (tile, cell) {\n  this.grid.cells[tile.x][tile.y] = null;\n  this.grid.cells[cell.x][cell.y] = tile;\n  tile.updatePosition(cell);\n}; // Move tiles on the grid in the specified direction\n\n\nGameManager.prototype.move = function (direction) {\n  // 0: up, 1: right, 2: down, 3: left\n  var self = this;\n  if (this.isGameTerminated()) return; // Don't do anything if the game's over\n\n  var cell, tile;\n  var vector = this.getVector(direction);\n  var traversals = this.buildTraversals(vector);\n  var moved = false; // Save the current tile positions and remove merger information\n\n  this.prepareTiles(); // Traverse the grid in the right direction and move tiles\n\n  traversals.x.forEach(function (x) {\n    traversals.y.forEach(function (y) {\n      cell = {\n        x: x,\n        y: y\n      };\n      tile = self.grid.cellContent(cell);\n\n      if (tile) {\n        var positions = self.findFarthestPosition(cell, vector);\n        var next = self.grid.cellContent(positions.next); // Only one merger per row traversal?\n\n        if (next && next.value === tile.value && !next.mergedFrom) {\n          var merged = new Tile(positions.next, tile.value * 2);\n          merged.mergedFrom = [tile, next];\n          self.grid.insertTile(merged);\n          self.grid.removeTile(tile); // Converge the two tiles' positions\n\n          tile.updatePosition(positions.next); // Update the score\n\n          self.score += merged.value; // The mighty 2048 tile\n\n          if (merged.value === 2048) self.won = true;\n        } else {\n          self.moveTile(tile, positions.farthest);\n        }\n\n        if (!self.positionsEqual(cell, tile)) {\n          moved = true; // The tile moved from its original cell!\n        }\n      }\n    });\n  });\n\n  if (moved) {\n    this.addRandomTile();\n\n    if (!this.movesAvailable()) {\n      this.over = true; // Game over!\n    }\n\n    this.actuate();\n  }\n}; // Get the vector representing the chosen direction\n\n\nGameManager.prototype.getVector = function (direction) {\n  // Vectors representing tile movement\n  var map = {\n    0: {\n      x: 0,\n      y: -1\n    },\n    // Up\n    1: {\n      x: 1,\n      y: 0\n    },\n    // Right\n    2: {\n      x: 0,\n      y: 1\n    },\n    // Down\n    3: {\n      x: -1,\n      y: 0 // Left\n\n    }\n  };\n  return map[direction];\n}; // Build a list of positions to traverse in the right order\n\n\nGameManager.prototype.buildTraversals = function (vector) {\n  var traversals = {\n    x: [],\n    y: []\n  };\n\n  for (var pos = 0; pos < this.size; pos++) {\n    traversals.x.push(pos);\n    traversals.y.push(pos);\n  } // Always traverse from the farthest cell in the chosen direction\n\n\n  if (vector.x === 1) traversals.x = traversals.x.reverse();\n  if (vector.y === 1) traversals.y = traversals.y.reverse();\n  return traversals;\n};\n\nGameManager.prototype.findFarthestPosition = function (cell, vector) {\n  var previous; // Progress towards the vector direction until an obstacle is found\n\n  do {\n    previous = cell;\n    cell = {\n      x: previous.x + vector.x,\n      y: previous.y + vector.y\n    };\n  } while (this.grid.withinBounds(cell) && this.grid.cellAvailable(cell));\n\n  return {\n    farthest: previous,\n    next: cell // Used to check if a merge is required\n\n  };\n};\n\nGameManager.prototype.movesAvailable = function () {\n  return this.grid.cellsAvailable() || this.tileMatchesAvailable();\n}; // Check for available matches between tiles (more expensive check)\n\n\nGameManager.prototype.tileMatchesAvailable = function () {\n  var self = this;\n  var tile;\n\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      tile = this.grid.cellContent({\n        x: x,\n        y: y\n      });\n\n      if (tile) {\n        for (var direction = 0; direction < 4; direction++) {\n          var vector = self.getVector(direction);\n          var cell = {\n            x: x + vector.x,\n            y: y + vector.y\n          };\n          var other = self.grid.cellContent(cell);\n\n          if (other && other.value === tile.value) {\n            return true; // These two tiles can be merged\n          }\n        }\n      }\n    }\n  }\n\n  return false;\n};\n\nGameManager.prototype.positionsEqual = function (first, second) {\n  return first.x === second.x && first.y === second.y;\n};\n\nmodule.exports = GameManager;\n\n},{\"./grid\":6,\"./tile\":11}],6:[function(require,module,exports){\n\"use strict\";\n\nvar Tile = require('./tile');\n\nfunction Grid(size, previousState) {\n  this.size = size;\n  this.cells = previousState ? this.fromState(previousState) : this.empty();\n} // Build a grid of the specified size\n\n\nGrid.prototype.empty = function () {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(null);\n    }\n  }\n\n  return cells;\n};\n\nGrid.prototype.fromState = function (state) {\n  var cells = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cells[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      var tile = state[x][y];\n      row.push(tile ? new Tile(tile.position, tile.value) : null);\n    }\n  }\n\n  return cells;\n}; // Find the first available random position\n\n\nGrid.prototype.randomAvailableCell = function () {\n  var cells = this.availableCells();\n\n  if (cells.length) {\n    return cells[Math.floor(Math.random() * cells.length)];\n  }\n};\n\nGrid.prototype.availableCells = function () {\n  var cells = [];\n  this.eachCell(function (x, y, tile) {\n    if (!tile) {\n      cells.push({\n        x: x,\n        y: y\n      });\n    }\n  });\n  return cells;\n}; // Call callback for every cell\n\n\nGrid.prototype.eachCell = function (callback) {\n  for (var x = 0; x < this.size; x++) {\n    for (var y = 0; y < this.size; y++) {\n      callback(x, y, this.cells[x][y]);\n    }\n  }\n}; // Check if there are any cells available\n\n\nGrid.prototype.cellsAvailable = function () {\n  return !!this.availableCells().length;\n}; // Check if the specified cell is taken\n\n\nGrid.prototype.cellAvailable = function (cell) {\n  return !this.cellOccupied(cell);\n};\n\nGrid.prototype.cellOccupied = function (cell) {\n  return !!this.cellContent(cell);\n};\n\nGrid.prototype.cellContent = function (cell) {\n  if (this.withinBounds(cell)) {\n    return this.cells[cell.x][cell.y];\n  } else {\n    return null;\n  }\n}; // Inserts a tile at its position\n\n\nGrid.prototype.insertTile = function (tile) {\n  this.cells[tile.x][tile.y] = tile;\n};\n\nGrid.prototype.removeTile = function (tile) {\n  this.cells[tile.x][tile.y] = null;\n};\n\nGrid.prototype.withinBounds = function (position) {\n  return position.x >= 0 && position.x < this.size && position.y >= 0 && position.y < this.size;\n};\n\nGrid.prototype.serialize = function () {\n  var cellState = [];\n\n  for (var x = 0; x < this.size; x++) {\n    var row = cellState[x] = [];\n\n    for (var y = 0; y < this.size; y++) {\n      row.push(this.cells[x][y] ? this.cells[x][y].serialize() : null);\n    }\n  }\n\n  return {\n    size: this.size,\n    cells: cellState\n  };\n};\n\nmodule.exports = Grid;\n\n},{\"./tile\":11}],7:[function(require,module,exports){\n\"use strict\";\n\nfunction HTMLActuator() {\n  this.tileContainer = document.querySelector(\".tile-container\");\n  this.scoreContainer = document.querySelector(\".score-container\");\n  this.bestContainer = document.querySelector(\".best-container\");\n  this.messageContainer = document.querySelector(\".game-message\");\n  this.helpHand = document.querySelector(\".helping-hand\");\n  this.helpText = document.querySelector(\".helping-text\");\n  this.helpTimeout = null;\n  this.score = 0;\n}\n\nHTMLActuator.prototype.actuate = function (grid, metadata) {\n  var self = this;\n  window.requestAnimationFrame(function () {\n    self.clearContainer(self.tileContainer);\n    grid.cells.forEach(function (column) {\n      column.forEach(function (cell) {\n        if (cell) {\n          self.addTile(cell);\n        }\n      });\n    });\n    self.updateScore(metadata.score);\n    self.updateBestScore(metadata.bestScore);\n\n    if (metadata.terminated) {\n      if (metadata.over) {\n        self.message(false); // You lose\n      } else if (metadata.won) {\n        self.message(true); // You win!\n      }\n    }\n  });\n}; // Continues the game (both restart and keep playing)\n\n\nHTMLActuator.prototype.continueGame = function () {\n  this.clearMessage();\n};\n\nHTMLActuator.prototype.clearContainer = function (container) {\n  while (container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n};\n\nHTMLActuator.prototype.addTile = function (tile) {\n  var self = this;\n  var wrapper = document.createElement(\"div\");\n  var inner = document.createElement(\"div\");\n  var position = tile.previousPosition || {\n    x: tile.x,\n    y: tile.y\n  };\n  var positionClass = this.positionClass(position); // We can't use classlist because it somehow glitches when replacing classes\n\n  var classes = [\"tile\", \"tile-\" + tile.value, positionClass];\n  if (tile.value > 2048) classes.push(\"tile-super\");\n  this.applyClasses(wrapper, classes);\n  inner.classList.add(\"tile-inner\");\n  inner.textContent = tile.value;\n\n  if (tile.previousPosition) {\n    // Make sure that the tile gets rendered in the previous position first\n    window.requestAnimationFrame(function () {\n      classes[2] = self.positionClass({\n        x: tile.x,\n        y: tile.y\n      });\n      self.applyClasses(wrapper, classes); // Update the position\n    });\n  } else if (tile.mergedFrom) {\n    classes.push(\"tile-merged\");\n    this.applyClasses(wrapper, classes); // Render the tiles that merged\n\n    tile.mergedFrom.forEach(function (merged) {\n      self.addTile(merged);\n    });\n  } else {\n    classes.push(\"tile-new\");\n    this.applyClasses(wrapper, classes);\n  } // Add the inner part of the tile to the wrapper\n\n\n  wrapper.appendChild(inner); // Put the tile on the board\n\n  this.tileContainer.appendChild(wrapper);\n};\n\nHTMLActuator.prototype.applyClasses = function (element, classes) {\n  element.setAttribute(\"class\", classes.join(\" \"));\n};\n\nHTMLActuator.prototype.normalizePosition = function (position) {\n  return {\n    x: position.x + 1,\n    y: position.y + 1\n  };\n};\n\nHTMLActuator.prototype.positionClass = function (position) {\n  position = this.normalizePosition(position);\n  return \"tile-position-\" + position.x + \"-\" + position.y;\n};\n\nHTMLActuator.prototype.updateScore = function (score) {\n  this.clearContainer(this.scoreContainer);\n  var difference = score - this.score;\n  this.score = score;\n  this.scoreContainer.textContent = this.score;\n\n  if (difference > 0) {\n    var addition = document.createElement(\"div\");\n    addition.classList.add(\"score-addition\");\n    addition.textContent = \"+\" + difference;\n    this.scoreContainer.appendChild(addition);\n  }\n};\n\nHTMLActuator.prototype.updateBestScore = function (bestScore) {\n  this.bestContainer.textContent = bestScore;\n};\n\nHTMLActuator.prototype.message = function (won) {\n  var type = won ? \"game-won\" : \"game-over\";\n  var message = won ? \"You win!\" : \"Game over!\";\n  this.messageContainer.classList.add(type);\n  this.messageContainer.getElementsByTagName(\"p\")[0].textContent = message;\n};\n\nHTMLActuator.prototype.clearMessage = function () {\n  // IE only takes one value to remove at a time.\n  this.messageContainer.classList.remove(\"game-won\");\n  this.messageContainer.classList.remove(\"game-over\");\n};\n\nHTMLActuator.prototype.showHelp = function () {\n  window.setTimeout(function () {\n    this.helpHand.classList.add('shown');\n    this.helpText.classList.add('shown');\n  }.bind(this), 0);\n};\n\nHTMLActuator.prototype.hideHelp = function () {\n  if (this.helpTimeout !== null) {\n    window.clearTimeout(this.helpTimeout);\n    this.helpTimeout = null;\n  }\n\n  this.helpHand.classList.remove('shown');\n  this.helpText.classList.remove('shown');\n};\n\nHTMLActuator.prototype.blinkHelp = function () {\n  this.hideHelp();\n  this.helpTimeout = window.setTimeout(this.hideHelp.bind(this), 6000);\n  this.showHelp();\n};\n\nmodule.exports = HTMLActuator;\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n\nfunction KeyboardInputManager() {\n  this.events = {};\n\n  if (window.navigator.msPointerEnabled) {\n    //Internet Explorer 10 style\n    this.eventTouchstart = \"MSPointerDown\";\n    this.eventTouchmove = \"MSPointerMove\";\n    this.eventTouchend = \"MSPointerUp\";\n  } else {\n    this.eventTouchstart = \"touchstart\";\n    this.eventTouchmove = \"touchmove\";\n    this.eventTouchend = \"touchend\";\n  }\n\n  this.listen();\n}\n\nKeyboardInputManager.prototype.on = function (event, callback) {\n  if (!this.events[event]) {\n    this.events[event] = [];\n  }\n\n  this.events[event].push(callback);\n};\n\nKeyboardInputManager.prototype.emit = function (event, data) {\n  var callbacks = this.events[event];\n\n  if (callbacks) {\n    callbacks.forEach(function (callback) {\n      callback(data);\n    });\n  }\n};\n\nKeyboardInputManager.prototype.listen = function () {\n  var self = this;\n  var map = {\n    38: 0,\n    // Up\n    39: 1,\n    // Right\n    40: 2,\n    // Down\n    37: 3,\n    // Left\n    75: 0,\n    // Vim up\n    76: 1,\n    // Vim right\n    74: 2,\n    // Vim down\n    72: 3,\n    // Vim left\n    87: 0,\n    // W\n    68: 1,\n    // D\n    83: 2,\n    // S\n    65: 3 // A\n\n  }; // Respond to direction keys\n\n  document.addEventListener(\"keydown\", function (event) {\n    var modifiers = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;\n    var mapped = map[event.which];\n\n    if (!modifiers) {\n      if (mapped !== undefined) {\n        event.preventDefault();\n        self.emit(\"move\", mapped);\n      }\n    } // R key restarts the game\n\n\n    if (!modifiers && event.which === 82) {\n      self.restart.call(self, event);\n    }\n  }); // Respond to button presses\n\n  this.bindButtonPress(\".retry-button\", this.restart);\n  this.bindButtonPress(\".restart-button\", this.restart);\n  this.bindButtonPress(\".keep-playing-button\", this.keepPlaying); // Respond to swipe events\n\n  var touchStartClientX, touchStartClientY;\n  var gameContainer = document.getElementsByClassName(\"game-container\")[0];\n  gameContainer.addEventListener(this.eventTouchstart, function (event) {\n    if (!window.navigator.msPointerEnabled && event.touches.length > 1 || event.targetTouches.length > 1) {\n      return; // Ignore if touching with more than 1 finger\n    }\n\n    if (window.navigator.msPointerEnabled) {\n      touchStartClientX = event.pageX;\n      touchStartClientY = event.pageY;\n    } else {\n      touchStartClientX = event.touches[0].clientX;\n      touchStartClientY = event.touches[0].clientY;\n    }\n\n    event.preventDefault();\n  });\n  gameContainer.addEventListener(this.eventTouchmove, function (event) {\n    event.preventDefault();\n  });\n  gameContainer.addEventListener(this.eventTouchend, function (event) {\n    if (!window.navigator.msPointerEnabled && event.touches.length > 0 || event.targetTouches.length > 0) {\n      return; // Ignore if still touching with one or more fingers\n    }\n\n    var touchEndClientX, touchEndClientY;\n\n    if (window.navigator.msPointerEnabled) {\n      touchEndClientX = event.pageX;\n      touchEndClientY = event.pageY;\n    } else {\n      touchEndClientX = event.changedTouches[0].clientX;\n      touchEndClientY = event.changedTouches[0].clientY;\n    }\n\n    var dx = touchEndClientX - touchStartClientX;\n    var absDx = Math.abs(dx);\n    var dy = touchEndClientY - touchStartClientY;\n    var absDy = Math.abs(dy);\n\n    if (Math.max(absDx, absDy) > 10) {\n      // (right : left) : (down : up)\n      self.emit(\"move\", absDx > absDy ? dx > 0 ? 1 : 3 : dy > 0 ? 2 : 0);\n    }\n  });\n};\n\nKeyboardInputManager.prototype.restart = function (event) {\n  event.preventDefault();\n  this.emit(\"restart\");\n};\n\nKeyboardInputManager.prototype.keepPlaying = function (event) {\n  event.preventDefault();\n  this.emit(\"keepPlaying\");\n};\n\nKeyboardInputManager.prototype.bindButtonPress = function (selector, fn) {\n  var button = document.querySelector(selector);\n  button.addEventListener(\"click\", fn.bind(this));\n  button.addEventListener(this.eventTouchend, fn.bind(this));\n};\n\nmodule.exports = KeyboardInputManager;\n\n},{}],9:[function(require,module,exports){\n\"use strict\";\n\nwindow.fakeStorage = {\n  _data: {},\n  setItem: function setItem(id, val) {\n    return this._data[id] = String(val);\n  },\n  getItem: function getItem(id) {\n    return this._data.hasOwnProperty(id) ? this._data[id] : undefined;\n  },\n  removeItem: function removeItem(id) {\n    return delete this._data[id];\n  },\n  clear: function clear() {\n    return this._data = {};\n  }\n};\n\nfunction LocalStorageManager() {\n  this.bestScoreKey = \"bestScore\";\n  this.gameStateKey = \"gameState\";\n  var supported = this.localStorageSupported();\n  this.storage = supported ? window.localStorage : window.fakeStorage;\n}\n\nLocalStorageManager.prototype.localStorageSupported = function () {\n  var testKey = \"test\";\n\n  try {\n    var storage = window.localStorage;\n    storage.setItem(testKey, \"1\");\n    storage.removeItem(testKey);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}; // Best score getters/setters\n\n\nLocalStorageManager.prototype.getBestScore = function () {\n  return this.storage.getItem(this.bestScoreKey) || 0;\n};\n\nLocalStorageManager.prototype.setBestScore = function (score) {\n  this.storage.setItem(this.bestScoreKey, score);\n}; // Game state getters/setters and clearing\n\n\nLocalStorageManager.prototype.getGameState = function () {\n  var stateJSON = this.storage.getItem(this.gameStateKey);\n  return stateJSON ? JSON.parse(stateJSON) : null;\n};\n\nLocalStorageManager.prototype.setGameState = function (gameState) {\n  this.storage.setItem(this.gameStateKey, JSON.stringify(gameState));\n};\n\nLocalStorageManager.prototype.clearGameState = function () {\n  this.storage.removeItem(this.gameStateKey);\n};\n\nmodule.exports = LocalStorageManager;\n\n},{}],10:[function(require,module,exports){\n\"use strict\";\n\nrequire('./bind_polyfill');\n\nrequire('./classlist_polyfill');\n\nrequire('./animframe_polyfill');\n\nrequire('./application');\n\n},{\"./animframe_polyfill\":1,\"./application\":2,\"./bind_polyfill\":3,\"./classlist_polyfill\":4}],11:[function(require,module,exports){\n\"use strict\";\n\nfunction Tile(position, value) {\n  this.x = position.x;\n  this.y = position.y;\n  this.value = value || 2;\n  this.previousPosition = null;\n  this.mergedFrom = null; // Tracks tiles that merged together\n}\n\nTile.prototype.savePosition = function () {\n  this.previousPosition = {\n    x: this.x,\n    y: this.y\n  };\n};\n\nTile.prototype.updatePosition = function (position) {\n  this.x = position.x;\n  this.y = position.y;\n};\n\nTile.prototype.serialize = function () {\n  return {\n    position: {\n      x: this.x,\n      y: this.y\n    },\n    value: this.value\n  };\n};\n\nmodule.exports = Tile;\n\n},{}]},{},[10]);\n"]}