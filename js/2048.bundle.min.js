!function o(r,a,l){function h(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var s=a[e]={exports:{}};r[e][0].call(s.exports,function(t){return h(r[e][1][t]||t)},s,s.exports,o,r,a,l)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)h(l[t]);return h}({1:[function(t,e,i){"use strict";var n=t("./grid"),c=t("./tile");function s(t,e,i,n,s){this.config=s,this.size=s.size,this.storageManager=new n,this.view=new i(s.strings),t.append(this.view.element),this.inputManager=new e,this.startTiles=2,this.inputManager.bindGameContainer(this.view.gameContainer),this.inputManager.bindRestartButton(this.view.restartButton),this.inputManager.bindRestartButton(this.view.retryButton),this.inputManager.bindKeepPlayingButton(this.view.keepPlayingButton),this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.helpTimeout=null,this.setup(),this.view.blinkHelp()}s.prototype.restart=function(){this.config.persistGameState&&this.storageManager.clearGameState(),this.view.continueGame(),this.setup(),this.view.blinkHelp()},s.prototype.keepPlaying=function(){this.keepPlaying=!0,this.view.continueGame()},s.prototype.isGameTerminated=function(){return this.over||this.won&&!this.keepPlaying},s.prototype.setup=function(){var t=null;this.config.persistGameState&&(t=this.storageManager.getGameState()),t?(this.grid=new n(t.grid.size,t.grid.cells),this.score=t.score,this.over=t.over,this.won=t.won,this.keepPlaying=t.keepPlaying):(this.grid=new n(this.size),this.score=0,this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles()),this.actuate()},s.prototype.addStartTiles=function(){for(var t=0;t<this.startTiles;t++)this.addRandomTile()},s.prototype.addRandomTile=function(){if(this.grid.cellsAvailable()){var t=Math.random()<.9?2:4,e=new c(this.grid.randomAvailableCell(),t);this.grid.insertTile(e)}},s.prototype.actuate=function(){this.storageManager.getBestScore()<this.score&&this.storageManager.setBestScore(this.score),this.config.persistGameState&&(this.over?this.storageManager.clearGameState():this.storageManager.setGameState(this.serialize())),this.view.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.storageManager.getBestScore(),terminated:this.isGameTerminated()})},s.prototype.serialize=function(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying}},s.prototype.prepareTiles=function(){this.grid.eachCell(function(t,e,i){i&&(i.mergedFrom=null,i.savePosition())})},s.prototype.moveTile=function(t,e){this.grid.cells[t.x][t.y]=null,(this.grid.cells[e.x][e.y]=t).updatePosition(e)},s.prototype.move=function(t){var o=this;if(!this.isGameTerminated()){var r,a,l=this.getVector(t),e=this.buildTraversals(l),h=!1;this.prepareTiles(),e.x.forEach(function(s){e.y.forEach(function(t){if(r={x:s,y:t},a=o.grid.cellContent(r)){var e=o.findFarthestPosition(r,l),i=o.grid.cellContent(e.next);if(i&&i.value===a.value&&!i.mergedFrom){var n=new c(e.next,2*a.value);n.mergedFrom=[a,i],o.grid.insertTile(n),o.grid.removeTile(a),a.updatePosition(e.next),o.score+=n.value,2048===n.value&&(o.won=!0)}else o.moveTile(a,e.farthest);o.positionsEqual(r,a)||(h=!0)}})}),h&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}},s.prototype.getVector=function(t){return{0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}}[t]},s.prototype.buildTraversals=function(t){for(var e={x:[],y:[]},i=0;i<this.size;i++)e.x.push(i),e.y.push(i);return 1===t.x&&(e.x=e.x.reverse()),1===t.y&&(e.y=e.y.reverse()),e},s.prototype.findFarthestPosition=function(t,e){for(var i;t={x:(i=t).x+e.x,y:i.y+e.y},this.grid.withinBounds(t)&&this.grid.cellAvailable(t););return{farthest:i,next:t}},s.prototype.movesAvailable=function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},s.prototype.tileMatchesAvailable=function(){for(var t,e=0;e<this.size;e++)for(var i=0;i<this.size;i++)if(t=this.grid.cellContent({x:e,y:i}))for(var n=0;n<4;n++){var s=this.getVector(n),o={x:e+s.x,y:i+s.y},r=this.grid.cellContent(o);if(r&&r.value===t.value)return!0}return!1},s.prototype.positionsEqual=function(t,e){return t.x===e.x&&t.y===e.y},e.exports=s},{"./grid":2,"./tile":11}],2:[function(t,e,i){"use strict";var r=t("./tile");function n(t,e){this.size=t,this.cells=e?this.fromState(e):this.empty()}n.prototype.empty=function(){for(var t=[],e=0;e<this.size;e++)for(var i=t[e]=[],n=0;n<this.size;n++)i.push(null);return t},n.prototype.fromState=function(t){for(var e=[],i=0;i<this.size;i++)for(var n=e[i]=[],s=0;s<this.size;s++){var o=t[i][s];n.push(o?new r(o.position,o.value):null)}return e},n.prototype.randomAvailableCell=function(){var t=this.availableCells();if(t.length)return t[Math.floor(Math.random()*t.length)]},n.prototype.availableCells=function(){var n=[];return this.eachCell(function(t,e,i){i||n.push({x:t,y:e})}),n},n.prototype.eachCell=function(t){for(var e=0;e<this.size;e++)for(var i=0;i<this.size;i++)t(e,i,this.cells[e][i])},n.prototype.cellsAvailable=function(){return!!this.availableCells().length},n.prototype.cellAvailable=function(t){return!this.cellOccupied(t)},n.prototype.cellOccupied=function(t){return!!this.cellContent(t)},n.prototype.cellContent=function(t){return this.withinBounds(t)?this.cells[t.x][t.y]:null},n.prototype.insertTile=function(t){this.cells[t.x][t.y]=t},n.prototype.removeTile=function(t){this.cells[t.x][t.y]=null},n.prototype.withinBounds=function(t){return 0<=t.x&&t.x<this.size&&0<=t.y&&t.y<this.size},n.prototype.serialize=function(){for(var t=[],e=0;e<this.size;e++)for(var i=t[e]=[],n=0;n<this.size;n++)i.push(this.cells[e][n]?this.cells[e][n].serialize():null);return{size:this.size,cells:t}},e.exports=n},{"./tile":11}],3:[function(t,e,i){"use strict";function n(t){this.strings=t,this.element=document.createElement("div"),this.element.classList.add("game2048"),this.container=document.createElement("div"),this.container.classList.add("container"),this.element.append(this.container),this.gameContainer=document.createElement("div"),this.gameContainer.classList.add("game-container"),this.container.append(this.gameContainer),this.messageContainer=document.createElement("div"),this.messageContainer.classList.add("game-message"),this.messageContainerParagraph=document.createElement("p"),this.messageContainer.append(this.messageContainerParagraph),this.gameContainer.append(this.messageContainer);var e=document.createElement("div");e.classList.add("lower"),this.messageContainer.append(e),this.keepPlayingButton=document.createElement("a"),this.keepPlayingButton.classList.add("keep-playing-button"),this.keepPlayingButton.textContent=this.strings.KEEP_GOING,e.append(this.keepPlayingButton),this.retryButton=document.createElement("a"),this.retryButton.classList.add("retry-button"),this.retryButton.textContent=this.strings.TRY_AGAIN,e.append(this.retryButton),this.messageContainer.append(e);var i=document.createElement("div");i.classList.add("grid-container");for(var n=0;4!==n;n+=1){var s=document.createElement("div");s.classList.add("grid-row"),i.append(s);for(var o=0;4!==o;o+=1){var r=document.createElement("div");r.classList.add("grid-cell"),s.append(r)}}this.gameContainer.append(i),this.tileContainer=document.createElement("div"),this.tileContainer.classList.add("tile-container"),this.gameContainer.append(this.tileContainer),this.restartButton=document.createElement("a"),this.restartButton.classList.add("restart-button"),this.restartButton.textContent=this.strings.NEW_GAME,this.container.append(this.restartButton);var a=document.createElement("div");a.classList.add("score-wrapper"),a.classList.add("score-wrapper-score");var l=document.createElement("div");l.classList.add("label"),l.textContent=this.strings.SCORE,a.append(l),this.scoreContainer=document.createElement("div"),this.scoreContainer.classList.add("score-container"),this.scoreContainer.textContent="0",a.append(this.scoreContainer),this.container.append(a);var h=document.createElement("div");h.classList.add("score-wrapper"),h.classList.add("score-wrapper-best");var c=document.createElement("div");c.classList.add("label"),c.textContent=this.strings.HIGH_SCORE,h.append(c),this.bestContainer=document.createElement("div"),this.bestContainer.classList.add("best-container"),this.bestContainer.textContent="0",h.append(this.bestContainer),this.container.append(h),this.helpText=document.createElement("div"),this.helpText.classList.add("helping-text"),this.helpText.textContent=this.strings.HELP_TEXT,this.container.append(this.helpText),this.helpHand=document.createElement("div"),this.helpHand.classList.add("helping-hand"),this.container.append(this.helpHand),this.helpTimeout=null,this.score=0}n.prototype.actuate=function(t,e){var i=this;window.requestAnimationFrame(function(){i.clearContainer(i.tileContainer),t.cells.forEach(function(t){t.forEach(function(t){t&&i.addTile(t)})}),i.updateScore(e.score),i.updateBestScore(e.bestScore),e.terminated&&(e.over?i.message(!1):e.won&&i.message(!0))})},n.prototype.continueGame=function(){this.clearMessage()},n.prototype.clearContainer=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},n.prototype.addTile=function(t){var e=this,i=document.createElement("div"),n=document.createElement("div"),s=t.previousPosition||{x:t.x,y:t.y},o=this.positionClass(s),r=["tile","tile-"+t.value,o];2048<t.value&&r.push("tile-super"),this.applyClasses(i,r),n.classList.add("tile-inner"),n.textContent=t.value,t.previousPosition?window.requestAnimationFrame(function(){r[2]=e.positionClass({x:t.x,y:t.y}),e.applyClasses(i,r)}):t.mergedFrom?(r.push("tile-merged"),this.applyClasses(i,r),t.mergedFrom.forEach(function(t){e.addTile(t)})):(r.push("tile-new"),this.applyClasses(i,r)),i.appendChild(n),this.tileContainer.appendChild(i)},n.prototype.applyClasses=function(t,e){t.setAttribute("class",e.join(" "))},n.prototype.normalizePosition=function(t){return{x:t.x+1,y:t.y+1}},n.prototype.positionClass=function(t){return"tile-position-"+(t=this.normalizePosition(t)).x+"-"+t.y},n.prototype.updateScore=function(t){this.clearContainer(this.scoreContainer);var e=t-this.score;if(this.score=t,this.scoreContainer.textContent=this.score,0<e){var i=document.createElement("div");i.classList.add("score-addition"),i.textContent="+"+e,this.scoreContainer.appendChild(i)}},n.prototype.updateBestScore=function(t){this.bestContainer.textContent=t},n.prototype.message=function(t){var e=t?"game-won":"game-over",i=t?this.strings.YOU_WIN:this.strings.GAME_OVER;this.messageContainer.classList.add(e),this.messageContainerParagraph.textContent=i},n.prototype.clearMessage=function(){this.messageContainer.classList.remove("game-won"),this.messageContainer.classList.remove("game-over")},n.prototype.showHelp=function(){window.setTimeout(function(){this.helpHand.classList.add("shown"),this.helpText.classList.add("shown")}.bind(this),0)},n.prototype.hideHelp=function(){null!==this.helpTimeout&&(window.clearTimeout(this.helpTimeout),this.helpTimeout=null),this.helpHand.classList.remove("shown"),this.helpText.classList.remove("shown")},n.prototype.blinkHelp=function(){this.hideHelp(),this.helpTimeout=window.setTimeout(this.hideHelp.bind(this),6e3),this.showHelp()},e.exports=n},{}],4:[function(t,e,i){"use strict";function n(){this.events={},window.navigator.msPointerEnabled?(this.eventTouchstart="MSPointerDown",this.eventTouchmove="MSPointerMove",this.eventTouchend="MSPointerUp"):(this.eventTouchstart="touchstart",this.eventTouchmove="touchmove",this.eventTouchend="touchend")}n.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},n.prototype.emit=function(t,e){var i=this.events[t];i&&i.forEach(function(t){t(e)})},n.prototype.bindKeyboard=function(){var n=this,s={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener("keydown",function(t){var e=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey,i=s[t.which];e||void 0!==i&&(t.preventDefault(),n.emit("move",i)),e||82!==t.which||n.restart.call(n,t)})},n.prototype.bindGameContainer=function(t){var a,l,h=this;t.addEventListener(this.eventTouchstart,function(t){!window.navigator.msPointerEnabled&&1<t.touches.length||1<t.targetTouches.length||(l=window.navigator.msPointerEnabled?(a=t.pageX,t.pageY):(a=t.touches[0].clientX,t.touches[0].clientY),t.preventDefault())}),t.addEventListener(this.eventTouchmove,function(t){t.preventDefault()}),t.addEventListener(this.eventTouchend,function(t){if(!(!window.navigator.msPointerEnabled&&0<t.touches.length||0<t.targetTouches.length)){var e,i;i=window.navigator.msPointerEnabled?(e=t.pageX,t.pageY):(e=t.changedTouches[0].clientX,t.changedTouches[0].clientY);var n=e-a,s=Math.abs(n),o=i-l,r=Math.abs(o);10<Math.max(s,r)&&h.emit("move",r<s?0<n?1:3:0<o?2:0)}})},n.prototype.bindRestartButton=function(t){this.bindButtonPress(t,this.restart)},n.prototype.bindKeepPlayingButton=function(t){this.bindButtonPress(t,this.keepPlaying)},n.prototype.restart=function(t){t.preventDefault(),this.emit("restart")},n.prototype.keepPlaying=function(t){t.preventDefault(),this.emit("keepPlaying")},n.prototype.bindButtonPress=function(t,e){t.addEventListener("click",e.bind(this)),t.addEventListener(this.eventTouchend,e.bind(this))},e.exports=n},{}],5:[function(t,e,i){"use strict";function n(){this.bestScoreKey="IMAGINARY.game2048.bestScore",this.bestScoreDateKey="IMAGINARY.game2048.bestScoreDate",this.gameStateKey="IMAGINARY.game2048.gameState";var t=this.localStorageSupported();this.storage=t?window.localStorage:window.IMAGINARY.game2048.fakeStorage}void 0===window.IMAGINARY&&(window.IMAGINARY={}),void 0===window.IMAGINARY.game2048&&(window.IMAGINARY.game2048={}),window.IMAGINARY.game2048.fakeStorage={_data:{},setItem:function(t,e){return this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:void 0},removeItem:function(t){return delete this._data[t]},clear:function(){return this._data={}}},n.prototype.localStorageSupported=function(){try{var t=window.localStorage;return t.setItem("test","1"),t.removeItem("test"),!0}catch(t){return!1}},n.prototype.getCurrentDate=function(){function t(t){return t.toString().padStart(2,"0")}var e=new Date;return[e.getFullYear(),t(e.getMonth()+1),t(e.getDate())].join("-")},n.prototype.getBestScore=function(){return this.storage.getItem(this.bestScoreDateKey)===this.getCurrentDate()&&this.storage.getItem(this.bestScoreKey)||0},n.prototype.setBestScore=function(t){this.storage.setItem(this.bestScoreDateKey,this.getCurrentDate()),this.storage.setItem(this.bestScoreKey,t)},n.prototype.getGameState=function(){var t=this.storage.getItem(this.gameStateKey);return t?JSON.parse(t):null},n.prototype.setGameState=function(t){this.storage.setItem(this.gameStateKey,JSON.stringify(t))},n.prototype.clearGameState=function(){this.storage.removeItem(this.gameStateKey)},e.exports=n},{}],6:[function(t,e,i){"use strict";t("./polyfills/bind_polyfill"),t("./polyfills/classlist_polyfill"),t("./polyfills/animframe_polyfill");var n=t("./game_manager"),s=t("./input_manager"),o=t("./html_view"),r=t("./local_storage_manager"),a=t("./strings_de.json");window.requestAnimationFrame(function(){var t={size:4,persistGameState:!1,strings:a};new n(window.document.body,s,o,r,t)})},{"./game_manager":1,"./html_view":3,"./input_manager":4,"./local_storage_manager":5,"./polyfills/animframe_polyfill":7,"./polyfills/bind_polyfill":8,"./polyfills/classlist_polyfill":9,"./strings_de.json":10}],7:[function(t,e,i){"use strict";!function(){for(var s=0,t=["webkit","moz"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-s)),n=window.setTimeout(function(){t(e+i)},i);return s=e+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()},{}],8:[function(t,e,i){"use strict";Function.prototype.bind=Function.prototype.bind||function(e){var i=this;return function(t){t instanceof Array||(t=[t]),i.apply(e,t)}}},{}],9:[function(t,e,i){"use strict";!function(){if(!(void 0===window.Element||"classList"in document.documentElement)){var t,e,i,n=Array.prototype,s=n.push,o=n.splice,r=n.join;a.prototype={add:function(t){this.contains(t)||(s.call(this,t),this.el.className=this.toString())},contains:function(t){return-1!=this.el.className.indexOf(t)},item:function(t){return this[t]||null},remove:function(t){if(this.contains(t)){for(var e=0;e<this.length&&this[e]!=t;e++);o.call(this,e,1),this.el.className=this.toString()}},toString:function(){return r.call(this," ")},toggle:function(t){return this.contains(t)?this.remove(t):this.add(t),this.contains(t)}},window.DOMTokenList=a,t=HTMLElement.prototype,e="classList",i=function(){return new a(this)},Object.defineProperty?Object.defineProperty(t,e,{get:i}):t.__defineGetter__(e,i)}function a(t){for(var e=(this.el=t).className.replace(/^\s+|\s+$/g,"").split(/\s+/),i=0;i<e.length;i++)s.call(this,e[i])}}()},{}],10:[function(t,e,i){e.exports={KEEP_GOING:"Keep going",TRY_AGAIN:"Try again",NEW_GAME:"New Game",SCORE:"Score",HIGH_SCORE:"High Score",HELP_TEXT:"Swipe over the board to merge tiles with the same picture.",YOU_WIN:"You win!",GAME_OVER:"Game over!"}},{}],11:[function(t,e,i){"use strict";function n(t,e){this.x=t.x,this.y=t.y,this.value=e||2,this.previousPosition=null,this.mergedFrom=null}n.prototype.savePosition=function(){this.previousPosition={x:this.x,y:this.y}},n.prototype.updatePosition=function(t){this.x=t.x,this.y=t.y},n.prototype.serialize=function(){return{position:{x:this.x,y:this.y},value:this.value}},e.exports=n},{}]},{},[6]);
//# sourceMappingURL=2048.bundle.min.js.map
